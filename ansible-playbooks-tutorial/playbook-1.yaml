- hosts: localhost
  connection: local
  become: true
  tasks:
  - name: install nginx
    apt:
      name: nginx
      state: present
      update_cache: true

  - name: Copy nginx file over
    vars:
      var_after: "{{ nginx_config.diff.after }}"
      var_before: "{{ nginx_config.diff.before }}"
    copy:
      src: nginx.conf
      dest: /etc/nginx/nginx.conf
    register: nginx_config
    when: not var_before == var_after

  - name: Check if copy nginx file over succeeded
    debug:
      msg: "{{ var_after }} {{ var_before }}"

  - name: Restart nginx if needed
    service:
      name: nginx
      state: restarted
    when: nginx_config.changed == true